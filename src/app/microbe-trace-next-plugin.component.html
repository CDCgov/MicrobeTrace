<div class="m-content">
  <div class="m-portlet m-portlet--mobile" style="height:100%;">

    @if (!officialInstance()) {
      <div id="url-warning-div">This is not an official MicrobeTrace instance, please visit our production instance at <a href="https://microbetrace.cdc.gov/MicrobeTrace">https://microbetrace.cdc.gov/MicrobeTrace</a> or our development instance at <a href="https://cdcgov.github.io/MicrobeTrace">https://cdcgov.github.io/MicrobeTrace</a></div>
    }
    <mat-toolbar id="top-toolbar" class="nav-bar">
      <div class="navbar-logo">
        <span class="microbe-font">Microbe</span>
        <span class="trace-font">Trace</span>
        <span><img alt="microbetrace" class="mt-icon-toolbar" [src]="appRootUrl() + 'assets/images/Logo.png'"></span>
      </div>
      <div class="menu-items">
        <button class="navbar-item" mat-button [matMenuTriggerFor]="fileMenu"><i class="far nav-icon flaticon-file-1"></i>File<span class="dropdown-symbol">&#9660;</span></button>
        <mat-menu #fileMenu="matMenu" overlapTrigger="false">
          <!-- <button mat-menu-item (click)="FileClick('Stash Session')">Stash</button> -->
          <!-- <button mat-menu-item (click)="FileClick('Recall Session')">Recall</button> -->
          <button mat-menu-item (click)="FileClick('Save Session')">Save</button>
          <button mat-menu-item (click)="OpenExportDashboard()">Export Dashboard</button>
          <button mat-menu-item (click)="OpenExportTables()">Export Tables</button>
          <!-- <button mat-menu-item (click)="FileClick('Open Session')">Open</button> -->
          <button mat-menu-item (click)="FileClick('Open URL')">Open URL</button>
          <button mat-menu-item (click)="FileClick('Add Data')">Add Data</button>
          <!-- <button mat-menu-item (click)="FileClick('New Session')">New</button> -->
        </mat-menu>
        <button class="navbar-item" (click)="DisplayGlobalSettingsDialog()" mat-button><i class="far nav-icon flaticon-cogwheel-2"></i>Settings</button>
        <button class="navbar-item" mat-button [matMenuTriggerFor]="viewMenu"><i class="far nav-icon flaticon-web"></i>View<span class="dropdown-symbol">&#9660;</span></button>
        <mat-menu #viewMenu="matMenu" overlapTrigger="false">
          <button mat-menu-item (click)="Viewclick('2D Network')">2D Network</button>
          <button mat-menu-item (click)="Viewclick('Table')">Table</button>
          <button mat-menu-item (click)="Viewclick('Map')">Map</button>
          <button mat-menu-item (click)="Viewclick('Epi Curve')">Epi Curve</button>
          <button mat-menu-item (click)="Viewclick('Phylogenetic Tree')">Phylogenetic Tree</button>
          <button mat-menu-item (click)="Viewclick('Alignment View')">Alignment View</button>
          <button mat-menu-item (click)="Viewclick('Crosstab')">CrossTab</button>
          <button mat-menu-item (click)="Viewclick('Aggregate')">Aggregate</button>
          <button mat-menu-item (click)="Viewclick('Gantt Chart')">Gantt Chart</button>
          <button mat-menu-item (click)="Viewclick('Heatmap')">Heatmap</button>
          <button mat-menu-item (click)="Viewclick('Bubble')">Bubble</button>
          <button mat-menu-item (click)="Viewclick('Sankey')">Sankey</button>
          <button mat-menu-item (click)="Viewclick('Waterfall')">Waterfall</button>
        </mat-menu>
        <button class="navbar-item" mat-button [matMenuTriggerFor]="windowMenu"><i class="far nav-icon flaticon-web"></i>Window<span class="dropdown-symbol">&#9660;</span></button>
        <mat-menu #windowMenu="matMenu" overlapTrigger="false">
          <button mat-menu-item (click)="WindowClick('Reload Screen')">Reload</button>
          <button mat-menu-item (click)="WindowClick('Fullscreen')">Fullscreen</button>
        </mat-menu>
        <button class="navbar-item" mat-button [matMenuTriggerFor]="helpMenu"><i class="far nav-icon flaticon-questions-circular-button"></i>Help<span class="dropdown-symbol">&#9660;</span></button>
        <mat-menu #helpMenu="matMenu" overlapTrigger="false">
          <a href="https://github.com/CDCgov/MicrobeTrace/wiki" class="dropdown-item ifOnline" target="_blank" rel="noreferrer noopener" mat-menu-item>Help</a>
          <a href="https://github.com/CDCgov/MicrobeTrace/issues/new" class="dropdown-item ifOnline" target="_blank" rel="noreferrer noopener" mat-menu-item>Report Bug</a>
          <button (click)="openMT_Classic()" mat-menu-item>MicrobeTrace Classic</button>
          <button (click)="HelpClick('About')" mat-menu-item>About</button>
        </mat-menu>
        <!-- <button class="navbar-item" mat-button [matMenuTriggerFor]="langMenu"><i class="far nav-icon flaticon-earth-globe"></i>Language<span class="dropdown-symbol">&#9660;</span></button>
        <mat-menu #langMenu="matMenu" overlapTrigger="false">
          <button mat-menu-item >English</button>
          <button mat-menu-item >Spanish</button>
        </mat-menu> -->
      </div>
      <div id="search-form" class="form-inline navbar-form">
        <label for="search">Search</label>
        <div class="autocomplete-wrapper">
          <input type="search" id="search" class="form-control form-control-sm" (input)="onSearch()" [(ngModel)]="searchText" placeholder="Nodes">
          <ul id="search-results"></ul>
        </div>
        <button id="casesensitivebutton" (click)="onCaseSensitiveChange()" type="button" class="btn btn-light btn-sm" data-toggle="button" aria-pressed="false" autocomplete="off" title="Match Case">
          <span>C</span>
        </button>
        <button id="wholewordbutton" type="button" (click)="onWholeWordChange()" class="btn btn-light btn-sm" data-toggle="button" aria-pressed="false" autocomplete="off" title="Match Whole Word">
          <span>W</span>
        </button>

        <select [(ngModel)]="searchField" (ngModelChange)="onSearchFieldChange($event)" id="search-field"  class="form-control form-control-sm nodeValues">
          <option val="id">ID</option>
        </select>
      </div>
    </mat-toolbar>

    <div #visualwrapper id="visualwrapper" class="kt-container  kt-grid__item kt-grid__item--fluid " style="margin: 6px 6px 0 6px;" [style.height.px]="getHeight()">
      <div class="kt-portlet kt-portlet--mobile" style="height:100%">
        <div class="kt-portlet__head kt-portlet__head--lg" style="height:100%">
          <div class="m-portlet__body" style="flex: 1 100%; max-width:100%; height:100%">
            <!-- TODO: Add back or replace-->
            <!-- <golden-layout-root #goldenLayout></golden-layout-root> -->
            <app-golden-layout-host #goldenLayoutHost></app-golden-layout-host>
          </div>
        </div>
      </div>

      <p-dialog class="table-z-index" id="global-settings-link-color-table"
        position="right"
        [(visible)]="GlobalSettingsLinkColorDialogSettings.isVisible"
        [style]="{'z-index': '1'}"
        (onShow)="showLinkColorTable()"
        (onHide)="hideLinkColorTable()"
        >
        <ng-template pTemplate="header">
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <span>Link Color Table</span>
            <span style="overflow: visible; position: relative;">
              <button title="Settings" class="btn btn-sm btn-clean btn-icon btn-icon-md" style="float:left" (click)="toggleColorTableSettings('link-color')"><i class="pi pi-cog"></i></button>
              <div id="linkColorTableSettings" class="dropdown-menu" style="display: none;">
                <button id="linkColorCounts" class="dropdown-item" (click)="toggleColorTableColumns('link-color', 'tableCounts')">
                  <span>Show Counts</span>
                  <i [className]="this.widgets['link-color-table-counts'] ? 'pi pi-check' : 'pi pi-times'" style="line-height: 1.5"></i>
                </button>
                <button id="linkColorFrequencies" class="dropdown-item" (click)="toggleColorTableColumns('link-color', 'tableFreq')">
                  <span>Show Frequencies</span>
                  <i [className]="this.widgets['link-color-table-frequencies'] ? 'pi pi-check' : 'pi pi-times'" style="line-height: 1.5"></i>
                </button>
              </div>
            </span>
          </div>
        </ng-template>
        <div style="max-height: 50vh">
          <table #linkColorTable id="link-color-table" style="width:100%;height:100%;"></table>
        </div>
      </p-dialog>


      <p-dialog id="global-settings-node-color-table"
        position="left"
        [(visible)]="GlobalSettingsNodeColorDialogSettings.isVisible"
        (onShow)="showNodeColorTable()"
        (onHide)="hideNodeColorTable()"
        >
        <ng-template pTemplate="header">
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <span>Node Color Table</span>
            <span style="overflow: visible; position: relative;">
              <button title="Settings" class="btn btn-sm btn-clean btn-icon btn-icon-md" style="float:left" (click)="toggleColorTableSettings('node-color')"><i class="pi pi-cog"></i></button>
              <div id="nodeColorTableSettings" class="dropdown-menu" style="display: none;">
                <button id="nodeColorCounts" class="dropdown-item" (click)="toggleColorTableColumns('node-color', 'tableCounts')">
                  <span>Show Counts</span>
                  <i [className]="this.widgets['node-color-table-counts'] ? 'pi pi-check' : 'pi pi-times'" style="line-height: 1.5"></i>
                </button>
                <button id="nodeColorFrequencies" class="dropdown-item" (click)="toggleColorTableColumns('node-color', 'tableFreq')">
                  <span>Show Frequencies</span>
                  <i [className]="this.widgets['node-color-table-frequencies'] ? 'pi pi-check' : 'pi pi-times'" style="line-height: 1.5"></i>
                </button>
              </div>
            </span>
          </div>
        </ng-template>
        <div style="max-height: 50vh">
          <table #nodeColorTable id="node-color-table" style="width:100%;height:100%;"></table>
        </div>
      </p-dialog>
    </div>

    <div id="overlay" appDnd (fileDropped)="prepareFilesLists($event)">
      <input class="dnd-input" type="file" #fileDropRef id="fileDropRef" multiple (change)="prepareFilesLists($event.target.files)" />
      <div class="welcome-msg">
        <div id="welcome-title" class="top">
          <span class="primary">Welcome to </span>
          <span class="microbe primary">Microbe</span>
          <span class="primary">Trace&#8482;</span>
          <!-- <span><img class="mt-icon" src="../../assets/images/Logo.png"></span> -->
          <!-- Swap/Uncomment when building productions -->
          <span><img alt="microbetrace" class="mt-icon" [src]="appRootUrl() + 'assets/images/Logo.png'"></span>
        </div>
        <div id="welcome-description" class="bottom primary">The Visualization Multitool for Molecular Epidemiology and Bioinformatics</div>
      </div>
      <div id="add-data-container" class="add-data-container">
        <a class="here-link primary" style="position: relative; z-index: 5; font-size: 20px;" appendTo="body" href="https://microbetrace.cdc.gov/MicrobeTraceClassic/" target="_blank" >Visit MicrobeTrace Classic</a>
        <div class="files-msg">
          <span class="primary">Click </span>
          <a class="here-link primary" for="fileDropRef">here</a>
          <span class="primary"> or Drag & Drop files to load data</span>
        </div>
        <div class="add-btns primary">
          <!-- TODO: add back in when recall is ready-->
          <!-- <button mat-raised-button color="primary" class="recall" (click)="recallClicked()">Recall Previous Session</button> -->
          <button mat-raised-button color="primary" (click)="continueClicked()">Continue with Sample Dataset</button>
        </div>
      </div>
      <!-- <div id="onload-container" class="launch-options-container primary">
      <span class="onload-bold">Onload Settings:</span>
      <span>Distance Metric: <span class="option-value" [matMenuTriggerFor]="metricMenu">{{metric}} <span class="onload-dropdown-symbol">&#9660;</span></span></span>
      <span id="ambiguities-menu">Ambiguities: <span class="option-value" [matMenuTriggerFor]="ambiMenu">{{ambiguity}} <span class="onload-dropdown-symbol">&#9660;</span></span></span>
      <span>View to Launch: <span class="option-value" [matMenuTriggerFor]="viewMenuBottom">{{launchView}} <span class="onload-dropdown-symbol">&#9660;</span></span></span>
      <span class="threshold-option">Link Threshold:
        <form class="threshold-input">
          <mat-form-field class="threshold-input-length">
            <mat-label></mat-label>
            <input matInput (input)="updateThreshold($event)" [value]="threshold">
          </mat-form-field>
        </form>
      </span>
    </div>
    <mat-menu #metricMenu="matMenu"overlapTrigger="false">
      <button mat-menu-item (click)="updateMetric('TN93')">TN93</button>
      <button mat-menu-item (click)="updateMetric('SNPs')">SNPs</button>
    </mat-menu>
    <mat-menu #ambiMenu="matMenu" overlapTrigger="false">
      <button mat-menu-item (click)="updateAmbiguity('Average')">Average</button>
      <button mat-menu-item (click)="updateAmbiguity('Resolve')">Resolve</button>
      <button mat-menu-item (click)="updateAmbiguity('Skip')">Skip</button>
      <button mat-menu-item (click)="updateAmbiguity('GapMM')">GapMM</button>
      <button mat-menu-item (click)="updateAmbiguity('HIV-Trace -g')">HIV-Trace -g</button>
    </mat-menu>
    <mat-menu #viewMenuBottom="matMenu" overlapTrigger="false">
      <button mat-menu-item (click)="updateLaunchView('2D Network')">2D Network</button>
      <button mat-menu-item (click)="updateLaunchView('Table')">Table</button>
      <button mat-menu-item (click)="updateLaunchView('Map')">Bubbles</button>
      <button mat-menu-item (click)="updateLaunchView('Phylogenetic Tree')">Phylogenetic Tree</button>
    </mat-menu> -->
  </div>

  <p-dialog id="global-settings-modal"
    [(visible)]="GlobalSettingsDialogSettings.isVisible"
    header="Global Settings" >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <tabset #globalSettingsTab class="tab-container tabbable-line" style='width: 100%; height: 100%;'>
            <tab heading="{{'Filtering' | localize}}" customClass="m-tabs__item" style='width: 400px; height: 100%;'>

              <div id="filtering-config" role="tabpanel" aria-labelledby="filtering-tab">
                <div class="form-group row" title="By what metric would you like to measure distance?">
                  <div class="col-4">Distance Metric</div>
                  <div class="col-8">
                    <select id="default-distance-metric" class="form-control form-control-sm mr-5" [(ngModel)]="SelectedDistanceMetricVariable" (ngModelChange)="onDistanceMetricChanged()">
                      <option value="tn93">TN93</option>
                      <option value="snps">SNPs</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row" title="By what algorithm would you like to prune links from the network?">
                  <div class="col-4">Prune With
                    <a title="Click for more information" class="btn btn-sm" style="float:right; padding-left: 0px;" href="https://github.com/CDCgov/MicrobeTrace/wiki/Pruning-links-using-nearest-neighbor-algorithm" target="_blank"><i class="pi pi-info-circle"></i></a>
                  </div>
                  <div class="col-8">
                    <p-selectButton [options]="PruneWityTypes" [(ngModel)]="SelectedPruneWithTypesVariable" (ngModelChange)="onPruneWithTypesChanged(SelectedPruneWithTypesVariable)"></p-selectButton>
                  </div>
                </div>
                <div id="filtering-epsilon-row" class="form-group row" style="display: none;" title="Select a value for epislon to add links back to minimum spanning network. See 'A Novel Network Representation of SARS-CoV-2 Sequencing Data' for algorithm details.">
                  <div class="col-4">
                    <label for="filtering-epsilon">Epsilon: {{ SelectedEpsilonValue }}</label>
                  </div>
                  <div class="col-8">
                    <input type="range" class="form-control form-control-sm" min="-8" max="2" step=".01" [(ngModel)]="widgets['filtering-epsilon']" (ngModelChange)="onEpsilonValueChange()">
                  </div>
                </div>
                <div class="form-group row" title="What's the minimum number of nodes a cluster must have in order to be visible?">
                  <div class="col-4">
                    <label for="cluster-minimum-size">Minimum Cluster Size</label>
                  </div>
                  <div class="col-8">
                    <input type="number" class="form-control form-control-sm" min="1" value="1" step="1" [(ngModel)]="SelectedClusterMinimumSizeVariable" (ngModelChange)="onMinimumClusterSizeChanged()">
                  </div>
                </div>
                <div id="filtering-wrapper">
                  <div class="form-group row" title="By what variable would you like to prune links from the network?">
                    <div class="col-4"><label for="link-sort-variable">Filter Links on</label></div>
                    <div class="col-8">
                      <p-select id="link-sort-variable" [options]="ToolTipFieldList" appendTo="body" [(ngModel)]="SelectedLinkSortVariable" (onChange)="onLinkSortChanged()"></p-select>
                    </div>
                  </div>
                  <div class="form-group row" id="filtering-threshold" title="What's the maximum genetic distance you're willing to call a link?">
                    <div class="col-4"><label for="link-threshold">Filtering Threshold</label></div>
                    <div><svg id="link-threshold-sparkline" #linkThresholdSparkline style="width: 280px; height: 48px;"></svg></div>
                    <div class="col-8  offset-4">
                      <input type="number" class="form-control form-control-sm" id="link-threshold" min="-1" value="1" [step]="getCurrentThresholdStepSize()" [(ngModel)]="SelectedLinkThresholdVariable" (ngModelChange)="updateThreshold($event)">
                    </div>
                  </div>
                  <div class="form-group row" title="Click to reveal all hidden elements of the network.">
                    <div class="col-4"><label for="reveal-all">Reveal</label></div>
                    <div class="col-8">
                      <button type="button" id="reveal-all" (click)="revealClicked()" class="btn btn-light btn-sm w-100">Everything</button>
                    </div>
                  </div>
                </div>
                <div class="form-group row" hidden title="Click to reveal all hidden elements of the network.">
                  <div class="col-4"><label for="RevealAllTab">Reveal</label></div>
                  <div class="col-8">
                    <p-selectButton [options]="RevealTypes" [(ngModel)]="SelectedRevealTypesVariable" (onChange)="updateGlobalSettingsModel()"></p-selectButton>
                  </div>
                </div>
                <hr>
                  <div class="form-group row" title="Display a table of overview statistics for the network">
                    <div class="col-4">Statistics</div>
                    <div class="col-8">
                      <p-selectButton [options]="StatisticsTypes" [(ngModel)]="SelectedStatisticsTypesVariable" (onChange)="onShowStatisticsChanged()"></p-selectButton>
                    </div>
                  </div>
                </div>
              </tab>
              <tab heading="{{'Styling' | localize}}" customClass="m-tabs__item" style='width: 400px; height: 100%;'>

                <div id="style-config" role="tabpanel" aria-labelledby="style-tab">
                  <div class="form-group row" title="By what variable nodes be colored?">
                    <div class="col-4"><label for="node-color-variable">Color Nodes By</label></div>
                    <div class="col-8">
                      <p-select id="node-color-variable" [options]="FieldList" appendTo="body" [(ngModel)]="SelectedColorNodesByVariable" (onChange)="onColorNodesByChanged()"></p-select>
                    </div>
                  </div>
                  <div id="node-color-table-row" [hidden]="!ShowGlobalSettingsNodeColorTable" class="form-group row" title="Should MicrobeTrace display the table of colors?">
                    <div class="col-4"><label>Nodes Color Table</label></div>
                    <div class="col-8">
                      <p-selectButton [options]="NodeColorTableTypes" [(ngModel)]="SelectedNodeColorTableTypesVariable" (onChange)="onNodeColorTableChanged()"></p-selectButton>
                    </div>
                  </div>


                  @if (SelectedColorNodesByVariable === 'None') {
                    <div id="node-color-value-row" class="form-group row" title="What color should the nodes be?">
                      <div class="col-4"><label for="node-color">Nodes</label></div>
                      <div class="col-8">
                        <input type="color" id="node-color" class="form-control form-control-sm" value="#1f77b4" [(ngModel)]="SelectedNodeColorVariable" (ngModelChange)="onNodeColorChanged()">
                      </div>
                    </div>
                  }
                  <div class="form-group row" title="By what variable should links be colored?">
                    <div class="col-4"><label for="link-color-variable">Color Links By</label></div>
                    <div class="col-8">
                      <p-select id="link-tooltip-variable" [options]="ToolTipFieldList" appendTo="body" [(ngModel)]="SelectedColorLinksByVariable" (onChange)="onColorLinksByChanged()"></p-select>
                    </div>
                  </div>
                  @if (SelectedColorLinksByVariable !== 'None') {
                    <div id="link-color-table-row"  class="form-group row" title="Should MicrobeTrace display the table of colors?">
                      <div class="col-4"><label>Link Color Table</label></div>
                      <div class="col-8">
                        <p-selectButton [options]="LinkColorTableTypes" [(ngModel)]="SelectedLinkColorTableTypesVariable" (onChange)="onLinkColorTableChanged()"></p-selectButton>
                      </div>
                    </div>
                  }

                  @if (SelectedColorLinksByVariable === 'None') {
                    <div id="link-color-value-row" class="form-group row" title="What color should the links be?">
                      <div class="col-4"><label for="link-color">Links</label></div>
                      <div class="col-8">
                        <input type="color" id="link-color" class="form-control form-control-sm" [(ngModel)]="SelectedLinkColorVariable" (ngModelChange)="onLinkColorChanged()">
                      </div>
                    </div>
                  }

                  <div class="form-group row" title="What color should denote selection?">
                    <div class="col-4"><label for="selected-color">Selected</label></div>
                    <div class="col-8">
                      <input type="color" id="selected-color" class="form-control form-control-sm" value="#ff8300" [(ngModel)]="SelectedColorVariable" (ngModelChange)="updateGlobalSettingsModel()">
                    </div>
                  </div>
                  <div class="form-group row" title="What color should the background be?">
                    <div class="col-4"><label for="background-color">Background</label></div>
                    <div class="col-8">
                      <input type="color" id="background-color" class="form-control form-control-sm" value="#ffffff" [(ngModel)]="SelectedBackgroundColorVariable" (ngModelChange)="onBackgroundChanged()">
                    </div>
                  </div>
                  <div class="form-group row" title="Load an existing MicrobeTrace style file">
                    <div class="col-4">Apply Style</div>
                    <div class="col-8">
                      <input type="file" id="apply-style" class="d-none" accept=".style" [(ngModel)]="SelectedApplyStyleVariable" (change)="onApplyStyle($event)">
                      <label class="custom-file-label" for="apply-style">Choose MicrobeTrace Style File</label>
                    </div>
                  </div>
                </div>
              </tab>

              <tab heading="{{'Timeline' | localize}}" customClass="m-tabs__item" style='width: 400px; height: 100%;'>
                <div id="timeline-config" role="tabpanel" aria-labelledby="timeline-tab">
                  <div class="form-group row" title="By what variable timeline applied?">
                    <div class="col-4"><label for="node-timeline-variable">Timeline By</label></div>
                    <div class="col-8">
                      <p-select id="node-timeline-variable" [options]="FieldList" appendTo="body" [(ngModel)]="SelectedTimelineVariable" (onChange)="onTimelineChanged($event.value)"></p-select>
                    </div>
                  </div>
                  <div class="form-group row " title="How much time between ticks of the timeline (ms)?">
                    <div class="col-4"><label>Timeline Speed: {{ timelineSpeed }} ms</label></div>
                    <div class="col-8"><input type="range" class="custom-range" min="200" step="100" max="1000" [(ngModel)]="timelineSpeed"></div>
                  </div>
                  <div>Timeline works on 2D Network, Map, and Bubble Views.</div>
                </div>
              </tab>
            </tabset>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="btn-group" data-toggle="buttons">
          <button type="button" class="btn btn-primary" (click)="GlobalSettingsDialogSettings.setVisibility(false)">Done</button>
        </div>
      </div>
    </p-dialog><!-- /.modal -->



    <p-dialog id="open-auspice-url" [(visible)]="displayUrlDialog" header="Open Auspice JSON via URL">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <input type="text" id="auspice-url" class="form-control form-control-sm" [(ngModel)]="auspiceUrlVal" placeholder="URL of Auspice JSON to open" />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn" (click)="DisplayUrlDialog('Cancel')">Cancel</button>
            <button type="button" class="btn btn-success" id="url-open-button" (click)="DisplayUrlDialog('Open')">Open</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </p-dialog><!-- /.modal -->

    <p-dialog id="open-old-mt" [(visible)]="displayMTDialog" header="Open Auspice JSON in classic MicrobeTrace">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            Welcome to the newest version of MicrobeTrace! If you'd like to open your auspice JSON file in the previous version of MicrobeTrace, please click this link: <br />
            <a href="https://microbetrace.cdc.gov/MicrobeTrace/?url={{auspiceUrlVal}}">https://microbetrace.cdc.gov/MicrobeTrace/?url={{auspiceUrlVal}}</a>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn" (click)="DisplayMTDialog('Cancel')">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </p-dialog><!-- /.modal -->

    <p-dialog [(visible)]="showExportDashboardMenu"  header="Export Dashboard"  class="dialogSize"  (onHide)="showExportDashboardMenu=false"  appendTo="body">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body" style="min-width: 400px; height: 100%;">
            <div class="form-group row">
              <div class="col-9">
                <input type="text" class="form-control form-control-sm" placeholder="Filename" [(ngModel)]="ExportDashboardFilename" />
              </div>
              <div class="col-3">
                <select class="form-control form-control-sm">
                  <option selected>png</option>
                </select>
              </div>
            </div>
            <div>  <!-- Toggle Advanced Export Options -->
              <p-accordion [value]="null" [multiple]="true">
                <p-accordion-panel style="color:#495057">
                  <p-accordion-header>Advanced</p-accordion-header>
                  <p-accordion-content><div>
                    <div class="form-group row">
                      <div class="col-3">
                        <label for="network-export-scale">Scale</label>
                      </div>
                      <div class="col-9">
                        <input type="number" class="form-control form-control-sm" min="1" max="5" step="0.1" [(ngModel)]="ExportDashboardScale" (ngModelChange)="updateExportResolution()">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-3">Resolution</div>
                      <div id="network-export-dimensions" class="col-9 text-right">{{ ExportDashboardResolution.summary }}</div>
                    </div>
                  </div>
                </p-accordion-content>
              </p-accordion-panel>
            </p-accordion>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-error" (click)="showExportDashboardMenu = false">Cancel</button>
          <button type="button" id="network-export"  class="btn btn-primary" (click)="ExportDashboard()">Export</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </p-dialog>

  <p-dialog [(visible)]="showExportTablesMenu"  header="Export Tables"  class="dialogSize"  (onHide)="showExportTablesMenu=false"  appendTo="body">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body" style="min-width: 400px; height: 100%;">
          <div class="form-group row">
            <div class="col-9">
              <input type="text" class="form-control form-control-sm" placeholder="Filename" [(ngModel)]="ExportTablesFilename" />
            </div>
            <div class="col-3">
              <select class="form-control form-control-sm" [(ngModel)]="ExportTablesFileType">
                <option >png</option>
                <option >svg</option>
              </select>
            </div>
          </div>
          <div class="flex align-items-center row">
            <div class="col-5">
              <input type="checkbox" id="checkbox1" [(ngModel)]="exportTables['node-color']" [disabled]="SelectedColorNodesByVariable=='None'" style="margin-left: 10px;"/>
              <label for="checkbox1" [class.disabled]="SelectedColorNodesByVariable=='None'">Node Color Table</label>
            </div>
            <div class="col-5">
              <input type="checkbox" id="checkbox2" [(ngModel)]="exportTables['link-color']" [disabled]="SelectedColorLinksByVariable=='None'" style="margin-left: 10px;"/>
              <label for="checkbox2" [class.disabled]="SelectedColorLinksByVariable=='None'">Link Color Table</label>
            </div>
            <div class="col-5">
              <input type="checkbox" id="checkbox3" [(ngModel)]="exportTables['node-symbol']" [disabled]="commonService.session.style.widgets['node-symbol-variable']=='None'" style="margin-left: 10px;"/>
              <label for="checkbox3" [class.disabled]="commonService.session.style.widgets['node-symbol-variable']=='None'">Node Shape Table</label>
            </div>
            <div class="col-5">
              <input type="checkbox" id="checkbox4" [(ngModel)]="exportTables['polygon-color']" [disabled]="commonService.session.style.widgets['polygons-color-show']==false" style="margin-left: 10px;"/>
              <label for="checkbox4" [class.disabled]="commonService.session.style.widgets['polygons-color-show']==false">Group Table</label>
            </div>
            <br />

          </div>
          <div>  <!-- Toggle Advanced Export Options -->
            @if (ExportTablesFileType === 'png') {
              <p-accordion [value]="null" [multiple]="true">
                <p-accordion-panel style="color:#495057">
                  <p-accordion-header>Advanced</p-accordion-header>
                  <p-accordion-content><div>
                    <div class="form-group row">
                      <div class="col-3">
                        <label for="network-export-scale">Scale</label>
                      </div>
                      <div class="col-9">
                        <input type="number" class="form-control form-control-sm" min="1" max="5" step="0.1" [(ngModel)]="ExportTablesScale">
                      </div>
                    </div>
                  </div>
                </p-accordion-content>
              </p-accordion-panel>
            </p-accordion>
          }
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-error" (click)="showExportTablesMenu = false">Cancel</button>
        <button type="button" id="network-export"  class="btn btn-primary" (click)="ExportTables()">Export</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</p-dialog>

<p-dialog id="session-stash-modal" [(visible)]="displayStashDialog" header="Save Session">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-body">
        <div class="form-group row" title="What would you like to call this session?">
          <div class="col-7">
            <input style="height:42px" type="text" id="stash-name" class="form-control form-control-sm" [(ngModel)]="saveFileName" placeholder="Name your session!">
          </div>
          <div class="col-5">
            <p-select [options]="saveFileTypeOptions" [(ngModel)]="selectedSaveFileType" appendTo="body"></p-select>
          </div>
        </div>
        @if (selectedSaveFileType=='session') {
          <div class="form-group row" title="Should MicrobeTrace compress this save file?">
            <div class="col">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="save-file-compress" checked>
                <label class="form-check-label" for="save-file-compress">Compress?</label>
              </div>
              <div id="cluster-checkbox-container" class="form-check form-check-inline">
                <input class="form-check-input" [(ngModel)]="saveByCluster" type="checkbox" id="save-file-cluster">
                <label class="form-check-label" for="save-file-cluster">By Cluster</label>
              </div>
            </div>
          </div>
        }
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-error" (click)="DisplayStashDialog('Cancel')">Cancel</button>
        <button type="button" id="stash-data" class="btn btn-primary" (click)="DisplayStashDialog('Save')" [disabled]="saveFileName === undefined || saveFileName === ''">Save</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</p-dialog><!-- /.modal -->

<div class="view-controls">
  <p-dialog id="loading-information-modal" [(visible)]="displayloadingInformationModal" header="Processing Files...">
    <div class="modal-dialog" role="document">
      <div class="modal-content">


        <img class="img-responsive" [src]="commonService.appRootUrl() + 'assets/common/images/giphy.gif'" alt="logo" height="300" />

        <div id="loading-information-collapse" class="collapse show">
          <div id="loading-information" class="card card-body">

            @for (message of messages; track message) {
              <div>
                {{ message }}
              </div>
            }
            <br>

            </div>
          </div>

          <p-footer>
            <button type="button" class="btn btn-success" data-dismiss="modal" (click)="displayloadingInformationModal=false">Close</button>
          </p-footer>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </p-dialog>
  </div><!-- Loading Files/.modal -->


  <p-dialog id="about-dialog" [(visible)]="displayAbout" header="About Microbetrace">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <h3>
            <span>{{"MicrobeTrace" | localize}} </span>
            <small>v<span id="version">{{version}}</span><br /><span id="commit">commit: {{commitHash}}</span></small>
          </h3>
          <p>
            MicrobeTrace is an interactive web application that renders existing data from high-risk contact networks
            in an easy-to-use Graphical User Interface (GUI). The network visualization can be customized according to
            supplemental data sources and mathematical inferences like the most probable transmission pathways.
            MicrobeTrace is a highly responsive, visual sequence analytics tool which can reduce the gap between data
            production and analytics and help you to discover, understand, and display relationships (links) between
            patients (nodes). MicrobeTrace can be deployed on laptops to locations without any Internet access, thereby
            reducing both the startup cost and analysis time and effort.
          </p>
          <p class="about-links">
            <a href="https://github.com/CDCgov/MicrobeTrace/wiki" target="_blank" rel="noreferrer noopener">
              Click Here to Learn More
            </a>
          </p>
          <p>
          MicrobeTrace was built by the Molecular Epidemiology and Bionformatics Team at the CDC in Atlanta.</p>
          <a class="about-links" href="https://cdcgov.github.io/MEBT" target="_blank" rel="noreferrer noopener" style="display: block;">
            Click Here to See MEBT's Other Tools
          </a>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" (click)="DisplayAbout()">Close</button>
        </div>
      </div>
    </div>
  </p-dialog>
  <p-confirmDialog></p-confirmDialog> <!--This is for nearest neighbor confirmations, openNNConfirmation()-->

  <div id="main-panel" class="pane-container pane-horizontal">
    <noscript class="container-fluid">
      <div class="jumbotron">
        <h1>Sorry!</h1>
        <p class="lead">MicrobeTrace requires Javascript to run. Please <a href="https://www.enable-javascript.com/">enable Javascript</a> and refresh MicrobeTrace.</p>
      </div>
    </noscript>
    <div id="global-timeline-wrapper" style="display: none;">
      <div id="global-timeline" align="center">
        <div><button type="button" id="timeline-play-button" class="btn btn-light btn-sm" (click)="playTimeline()">{{playBtnText}}</button>
        <span id="global-timeline-field" contenteditable></span></div>
        <!-- <svg></svg>
        <mat-slider></mat-slider> -->
      </div>
    </div>
  </div>

  <p-dialog
    header="License Agreement"
    [(visible)]="display_eula_modal"
    [modal]="true"
    [dismissableMask]="false"
    [style]="{ width: '850px' }"
    appendTo="body"
    >
    <div style="margin: 16px;">
      <p>
        The material embodied in this software is provided to you “As-is” and without warranty of any kind, express, implied or otherwise, including without limitation, any warranty of fitness for a particular purpose. In no event shall the Centers for Disease Control and Prevention (CDC) or the United States (U.S.) government be liable to you or anyone else for any direct, special, incidental, indirect or consequential damages of any kind, or any damages whatsoever, including without limitation, loss of profit, loss of use, savings or revenue, or the claims of third parties, whether or not CDC or the U.S. Government has been advised of the possibility of such loss, however caused and on any theory of liability, arising out of or in connection with the possession, use or performance of this software.
      </p>
      <p>Please Click "Accept" to accept this agreement, or "Reject" to close this application.</p>
    </div>

    <ng-template pTemplate="footer">
      <div class="p-dialog-footer" style="padding-top: 35px;">
        <button class="btn btn-danger" (click)="on_eula_reject()">Reject</button>
        <button class="btn btn-primary" (click)="on_eula_accept()">Accept</button>
      </div>
    </ng-template>
  </p-dialog>



  <!-- <p-dialog class="table-z-index" id="global-settings-link-color-table"
  [position]="GlobalSettingsLinkColorDialogSettings.linkLeft"
  [(visible)]="GlobalSettingsLinkColorDialogSettings.isVisible"
  header="Link Color Table" [style]="{'z-index': '1'}"
  (onShow)="SelectedLinkColorTableTypesVariable='Show'"
  (onHide)="SelectedLinkColorTableTypesVariable='Hide'"
  >
  <div class="col-12" style="max-height: 50vh">
    <table id="link-color-table" style="width:100%;height:100%;"></table>
  </div>
</p-dialog> -->

<div id="color-transparency-wrapper">
  <input type="range" class="custom-range" id="color-transparency" min="0" max="1" step="0.05" value="1" >
</div>


</div>
</div>
